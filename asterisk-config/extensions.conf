[default]
include => ai-phone

[ai-phone]
exten => _X.,1,Answer()
same => n,Set(CHANNEL(language)=en)
same => n,NoOp(AI PHONE SERVICE ${EXTEN})

; Trigger Node to process
same => n,System(curl -s -X POST http://host.docker.internal:3000/call/start?exten=${EXTEN})

; Wait for Node to process and write the audio files
same => n,Wait(1)

; Get the next file to play from the queue
same => n,Set(NEXTFILE=${STRIP(${SHELL(head -n 1 /var/lib/asterisk/sounds/custom/tts/queue.txt)})})

; If the file is empty, hang up
same => n,GotoIf($["${NEXTFILE}"=""]?hangup)

; NoOp for logging
same => n,NoOp(PLAYING '${NEXTFILE}')

; Play the audio file
same => n,Playback(${NEXTFILE})

; Remove the played file from the queue
same => n,System(sed -i '1d' /var/lib/asterisk/sounds/custom/tts/queue.txt)

same => n(hangup),Hangup()

[science-service]
exten => s,1,Answer()
same => n,NoOp(*** SCIENCE SERVICE STARTED ***)
same => n,System(curl -s -X POST http://host.docker.internal:3000/science)
same => n,Hangup()
