[ai-phone]
exten => _X.,1,Answer()
 same => n,Set(CHANNEL(language)=en)
 same => n,NoOp(AI PHONE SERVICE ${EXTEN})

 ; --- RANDOM FAILURE GATE (1 in 4) ---
 same => n,Set(FAIL=${RAND(1,4)})
 same => n,GotoIf($["${FAIL}"="1"]?error:normal)

 ; ---------- ERROR PATH ----------
 same => n(error),NoOp(SIMULATED NETWORK FAILURE)
 same => n,Set(ERR=${RAND(1,5)})
 same => n,Goto(error-${ERR})

exten => _X.,n(error-1),Playback(attflood)
 same => n,Hangup()

exten => _X.,n(error-2),Playback(attearth)
 same => n,Hangup()

exten => _X.,n(error-3),Playback(atttor)
 same => n,Hangup()

exten => _X.,n(error-4),Playback(attemerg)
 same => n,Hangup()

exten => _X.,n(error-5),Playback(attnoans)
 same => n,Hangup()

 ; ---------- NORMAL PATH ----------
exten => _X.,n(normal),NoOp(CALL PASSES THROUGH)

 same => n,System(curl -s -X POST http://127.0.0.1:3000/call/start?exten=${EXTEN})

 same => n(loop),NoOp(AI TURN)
 same => n,Record(/tmp/input.wav,3,6)

 ; BLOCK until Node finishes the turn
 same => n,AGI(/usr/bin/node,/path/to/turn.js)

 same => n,Goto(loop)
