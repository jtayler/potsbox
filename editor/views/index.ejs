<%- include("partials/header", { title: "Editor" }) %>

<div class="container justify-content-center col-md-10 py-4">
  <h1 class="mb-4">PotsBox Editor</h1>

  <div class="row justify-content-center">
    <!-- Lines -->
    <div class="col-md-11">
      <h3 class="pt-3">Lines</h3>
      <ul class="list-group">
        <% lines.forEach(line => { %>
<li class="list-group-item pb-0 list-link">
  <a href="/editor/line/<%= line.id %>" class="stretched-link text-reset text-decoration-none">
    <p class="mb-2">
      <strong class="text-primary">
  <i class="fa-solid fa-phone-volume me-1"></i>
        <%= line.dial_code || '(no extension)' %> •
        <%= line.name || '(unnamed line)' %>
      </strong><br>
      <%= line.note || '(no note)' %>
    </p>
  </a>
</li>
        <% }) %>
      </ul>
      <h3 class="pt-3">Services</h3>
<ul class="list-group">
<% services.forEach(service => { %>
  <li class="list-group-item pb-3 list-link position-relative">
    <a
      href="/editor/service/<%= service.id %>"
      class="stretched-link text-reset text-decoration-none"
    >
      <strong class="text-primary">

<%
  const hasRequires = service.requires && String(service.requires).trim().length > 0;

  // Primary: what the service does
  const primary = service.is_loop ? 'fa-microphone' : 'fa-volume-high';

  // Secondary: remote/dependency badge
  const badge = hasRequires ? 'fa-bolt' : null;
%>

<i class="fa-solid <%= primary %> me-1"></i>
<% if (badge) { %>
  <i class="fa-solid <%= badge %> me-1"></i>
<% } %>




<%
  const alias = service.dial_alias;
  const code  = service.dial_code;
  const showBoth = alias && code && alias !== code;
%>

<%= alias || '(no alias)' %>
<% if (showBoth) { %>
  (<%= code %>)
<% } %> •
        <%= service.name || '(unnamed service)' %>
      </strong>
    </a>
    <br>

    <%= service.note || '(no note)' %>
    Spoken by
    <strong>
      <%= service.voice
        ? service.voice.charAt(0).toUpperCase() + service.voice.slice(1)
        : 'Default'
      %>
    </strong>
    <br>

    <% if (service.is_loop) { %>
      <em class="text-success">This service replies to responses</em><br>
    <% } %>
  </li>
<% }) %>
</ul>
    </div>
  </div>
</div>
<%- include("partials/footer") %>

